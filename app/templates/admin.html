{% extends "base.html" %}
{% block content %}
  <h1 class="text-3xl font-bold leading-tight">{{ t('admin_title') }}</h1>
  <p class="mt-2 text-sm text-slate-600">{{ t('admin_pending_submissions') }}</p>

  <div class="mt-6 surface p-5 sm:p-6">
    <div class="font-semibold">{{ t('admin_content_title') }}</div>
    {% if saved %}
      <div class="mt-3 text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-xl p-3">{{ t('admin_content_saved') }}</div>
    {% endif %}
    {% if error %}
      <div class="mt-3 text-sm text-red-700 bg-red-50 border border-red-200 rounded-xl p-3">{{ error }}</div>
    {% endif %}
    <form class="mt-4 grid gap-4" method="post" action="/admin/founder-content" enctype="multipart/form-data">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
      <div>
        <label class="block text-sm font-medium">{{ t('admin_founder_name') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="founder_name" value="{{ site_content.founder_name }}" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_founder_intro') }}</label>
        <textarea class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 min-h-28 bg-white" name="founder_intro">{{ site_content.founder_intro }}</textarea>
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_founder_photo_url') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="founder_photo_url" value="{{ site_content.founder_photo_url }}" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_founder_photo_upload') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" type="file" name="founder_photo_file" accept="image/*" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_founder_video_url') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="founder_video_url" value="{{ site_content.founder_video_url }}" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_founder_video_upload') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" type="file" name="founder_video_file" accept="video/*" />
      </div>
      <div class="text-xs text-slate-500">{{ t('admin_upload_hint') }}</div>
      <div>
        <button class="btn-primary px-4 py-2 w-full sm:w-auto" type="submit">{{ t('admin_content_save') }}</button>
      </div>
    </form>
  </div>

  <div class="mt-6 surface p-5 sm:p-6">
    <div class="font-semibold">{{ t('admin_tutorial_categories_title') }}</div>
    <form class="mt-4 grid gap-4" method="post" action="/admin/tutorial-categories">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_category_title') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="title" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_category_description') }}</label>
        <textarea class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 min-h-20 bg-white" name="description"></textarea>
      </div>
      <div>
        <button class="btn-primary px-4 py-2 w-full sm:w-auto" type="submit">{{ t('admin_tutorial_category_create') }}</button>
      </div>
    </form>
    {% if tutorial_categories|length > 0 %}
      <div class="mt-4 text-sm text-slate-700">
        {% for c in tutorial_categories %}
          <div class="py-1"><b>{{ c.title }}</b> <span class="text-slate-500">({{ c.slug }})</span></div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="mt-6 surface p-5 sm:p-6">
    <div class="font-semibold">{{ t('admin_tutorials_title') }}</div>
    <form class="mt-4 grid gap-4" method="post" action="/admin/tutorials" enctype="multipart/form-data">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_category_pick') }}</label>
        <select class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="category_id" required>
          <option value="">{{ t('admin_tutorial_category_pick') }}</option>
          {% for c in tutorial_categories %}
            <option value="{{ c.id }}">{{ c.title }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_title') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="title" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_summary') }}</label>
        <textarea class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 min-h-20 bg-white" name="summary"></textarea>
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_body') }}</label>
        <textarea class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 min-h-32 bg-white" name="body"></textarea>
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_required_plan') }}</label>
        <select class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="required_plan">
          <option value="free">{{ t('plan_free_title') }}</option>
          <option value="pro">{{ t('plan_pro_title') }}</option>
          <option value="premium">{{ t('plan_premium_title') }}</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_video_url') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" name="video_url" />
      </div>
      <div>
        <label class="block text-sm font-medium">{{ t('admin_tutorial_file_upload') }}</label>
        <input class="mt-1 w-full border border-slate-300 rounded-xl px-3 py-2 bg-white" type="file" name="tutorial_file" />
      </div>
      <div>
        <button class="btn-primary px-4 py-2 w-full sm:w-auto" type="submit">{{ t('admin_tutorial_create') }}</button>
      </div>
    </form>

    {% if tutorials_admin|length > 0 %}
      <div class="mt-6 grid gap-3">
        {% for row in tutorials_admin %}
          <div class="border border-slate-200 rounded-xl p-3 text-sm bg-white/70">
            <div><b>{{ row.tutorial.title }}</b> <span class="text-slate-500">({{ row.tutorial.slug }})</span></div>
            <div class="text-slate-600">{{ row.category_title }} - {{ t('plan_' ~ row.tutorial.required_plan ~ '_title') }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="mt-6 grid gap-4">
      {% if updates|length == 0 %}
      <div class="surface p-6">{{ t('admin_no_pending') }}</div>
    {% else %}
      {% for u in updates %}
        <div class="surface p-6">
          <div class="flex items-center justify-between">
            <div class="font-semibold">{{ t('admin_update') }} {{ u.id }}</div>
            <div class="text-xs px-2 py-1 rounded-full border">{{ t('status_' ~ u.status) }}</div>
          </div>
          <pre class="mt-3 text-xs bg-white border border-slate-200 rounded-xl p-3 overflow-auto">{{ u.payload | tojson }}</pre>
          <div class="mt-3 text-xs text-slate-500">{{ t('admin_queue_note') }}</div>
        </div>
      {% endfor %}
    {% endif %}
  </div>
{% endblock %}
